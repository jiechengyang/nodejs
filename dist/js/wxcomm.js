var myCookie={getCookie:function(e){var t,n=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(n))?unescape(t[2]):null},delCookie:function(e){var t=new Date;t.setTime(t.getTime()-1);var n=getCookie(e);null!=n&&(document.cookie=e+"="+n+";expires="+t.toGMTString())},setCookie:function(e,t,n){var a=myCookie.getsec(n),i=new Date;i.setTime(i.getTime()+1*a),document.cookie=e+"="+escape(t)+";expires="+i.toGMTString()},getsec:function(){var e=1*str.substring(1,str.length),t=str.substring(0,1);return"s"==t?1e3*e:"h"==t?60*e*60*1e3:"d"==t?24*e*60*60*1e3:void 0}},CDBJS=function(){this.showflag=0,this.openid="",this.headarr=new Array,this.ajaxurl="?c=wx&a=cplistAjax";var e=this;this.lx="cg",this.changeshow=function(e,t,n){$("#"+n+t).toggle()},this.formser=function(e){for(var e=document.getElementById(e),t={},n=0;n<e.elements.length;n++){var a=e.elements[n];switch(a.type){case void 0:case"button":case"file":case"reset":case"submit":break;case"checkbox":case"radio":if(!a.checked)break;default:t[a.name]?t[a.name]=t[a.name]+","+a.value:t[a.name]=a.value}}return t},this.openxiang=function(e){layer.open({content:"请选择下一步操作？",btn:["账单明细","取消"],shadeClose:!0,yes:function(){window.location.href="?c=wxmsg&a=openxiang&id="+e},no:function(){$(this).hide()}})},this.addrow=function(e,t){var n=parseInt($("#"+t).find("tr.newtrtable:last").find("td input").attr("value"))+1,a=cdbjs.createTr(n);$("#"+t).append(a)},this.delrow=function(t,n){1!=$(".inittable tr.newtrtable").length&&(e.jsuan(),e.mingxi(),$(t).parent().parent().nextAll().each(function(){var e=$(this).find("td:eq(0) input").val();e-=1,$(this).find("td:eq(0) input").val(e)}),$(t).parent().parent().remove())},this.inittable=function(t,n,a){e.headarr=n;var i="<div><b>"+t+"</b></div>",o='<table class="tablesub" id="'+a+'" style="width:100%;" cellspacing="0" cellpadding="0" border="0"><tbody><td nowrap="" width="10%">序号</td>';for(var c in n)o+='<td nowrap="">'+n[c].head+"</td>";o+='<td nowrap="" width="5%">操作</td></tr>';var r=e.createTr(1);return o+=r+"</tbody></table>",i+=o+'<div><a href="javascript:;" onclick="cdbjs.addrow(this,\''+a+"')\">＋新增</a></div>"},this.createTr=function(t){var n='<tr class="newtrtable" chosed="0"><td ><input class="inputs" style="text-align:center" readonly="" temp="xuhao" value="'+t+'" name="items.xuhao[]" type="text" /><input value="0" name="items.id[]" type="hidden" /></td>',a="",i=e.headarr;for(var o in i){var c=i[o].type,r=i[o].name,l=i[o].readonly?"readonly":"",s="text"==c?"":0,d=void 0!=i[o]["class"]?i[o]["class"]:"";if("auto"==c)a+='<td><table cellpadding="0" border="0" width="98%"><tbody><tr><td width="100%"><input onblur="cdbjs.mingxi()" class="inputs '+r+'" style="width:99%" value=""  name="items.'+r+'[]" type="text" '+l+'/></td><td nowrap=""><a href="javascript:;" onclick="cdbjs.chosecp(this)" class="webbtn webbtn-chose">选择</a></td></tr></tbody></table>';else{var u="";"cg"==e.lx?"cgnum"!=r&&"cgprice"!=r||(u=' onchange="cdbjs.jsuan();cdbjs.mingxi()" onkeyup="cdbjs.jsuan();cdbjs.mingxi()"  onblur="cdbjs.jsuan()" '):"receive"==e.lx&&"cgnum"==r&&(u=' onchange="cdbjs.mingxi()" onkeyup="cdbjs.mingxi()"'),a+='<td><input class="inputs '+d+" "+r+'" value="'+s+'" maxlength="10" '+u+' name="items.'+r+'[]" type="'+c+'" '+l+"/></td>"}}return n+a+'<td><a href="javascript:;" onclick="cdbjs.delrow(this,'+t+')">删</a></td></tr>'},this.jsuan=function(){window.setTimeout(function(){$("#DzMoney").val(0);var e=0;$(".inittable .cgnum").each(function(t){var n=parseInt(this.value);void 0!=n&&null!=n&&""!=n||(n=0);var a=parseFloat($(".inittable .cgprice:eq("+t+")").val());void 0!=a&&null!=a&&""!=a||(a=0),e+=n*a,isNaN(e)&&(e=0)}),$("#DzMoney").val(parseFloat(e))},500)},this.mingxi=function(){window.setTimeout(function(){var t="";$(".inittable .cgname").each(function(n){var a=parseInt($(".inittable .cgnum:eq("+n+")").val());(void 0==a||null==a||""==a||isNaN(a))&&(a=0);var i=parseFloat($(".inittable .cgprice:eq("+n+")").val());if((void 0==i||null==i||""==i||isNaN(i))&&(i=0),"cg"==e.lx)0!=a&&(t+=this.value+a+$(".inittable .cgunit:eq("+n+")").val()+"共计:"+a*i+"元\r\n");else if("receive"==e.lx){var o=parseInt($(".inittable .cgkc:eq("+n+")").val());if(o<a)return void layer.open({content:"库存不足,"+this.value+"剩余库存量:"+o,skin:"footer"});0!=a&&(t+=this.value+a+$(".inittable .cgunit:eq("+n+")").val()+"\r\n")}}),$(".cgmingxi").val(t)},500)},this.changekey=function(){var t=jQuery("#changekey").val();layer.closeAll(),$.post(e.ajaxurl,{openid:e.openid,keywords:t},function(e){layer.open({type:1,title:"产品选择",maxmin:!0,shadeClose:!1,area:["1000px","700px"],content:e})})},this.changereload=function(){layer.closeAll(),$.post(e.ajaxurl,{openid:this.openid},function(e){layer.open({type:1,title:"产品选择",maxmin:!0,shadeClose:!1,area:["1000px","700px"],content:e})})},this.changecancl=function(){layer.closeAll()},this.changeok=function(t,n){var a=$("input[name='changecpinput']:checked").length;if(0==a)layer.open({content:"请选择产品",skin:"footer"});else{var i=$("input[name='changecpinput']:checked").attr("tmp"),o=$("input[name='changecpinput']:checked").val(),c=$("input[name='changecpinput']:checked").attr("xname");if($(".inittable tr[chosed='1']").find("input[name='items.cgname[]']").val(c),$(".inittable tr[chosed='1']").find("input[name='items.cgname[]']").css("width","75px"),$(".inittable tr[chosed='1']").find("input[name='items.id[]']").val(o),$(".inittable tr[chosed='1']").find("input[name='items.cgunit[]']").val(i),"receive"==e.lx){var r=$("input[name='changecpinput']:checked").attr("kc");$(".inittable tr[chosed='1']").find("input[name='items.cgkc[]']").val(r)}layer.closeAll()}},this.initevent=function(){$(".ZoomImg").length>0&&$(".ZoomImg").attr("onclick","cdbjs.ZoomImg(this)")},this.ZoomImg=function(e){var t=$(e).attr("src");return $.imgview({url:t}),!1},this.chosecp=function(t){$(".inittable tr").attr("chosed",0),$(t).parent().parent().parent().parent().parent().parent().attr("chosed",1),$.post(e.ajaxurl,{openid:this.openid},function(e){layer.open({type:1,title:"产品选择",maxmin:!0,shadeClose:!1,area:["1000px","700px"],content:e})})}},cdbjs=new CDBJS;CDBJS.prototype.delksinfo=function(e,t,n,a){alertMsg.confirm(t,{okCall:function(){$.post(n,{id:e},function(e){200==e.statusCode?(alertMsg.correct(e.message),$.pdialog.reload(a,{data:{},dialogId:"",callback:null}),navTabPageBreak()):alertMsg.error(e.message)},"json")}})},window.cdbjs=cdbjs,window.onload=function(){if(document.getElementsByClassName("inittable").length>0){var e=[{head:"<font color='red'>*</font>物品",name:"cgname",readonly:!0,type:"auto","class":"required"},{head:"<font color='red'>*</font>采购数量",name:"cgnum",readonly:!1,type:"number","class":"required"},{head:"单位",name:"cgunit",readonly:!0,type:"text"},{head:"单价",name:"cgprice",readonly:!1,type:"text","class":"required"}],t="采购物品",n="tablelist1",a=$(".inittable").attr("data");""!=a&&null!=a&&void 0!=a||(a="cg"),"receive"==a&&(e=[{head:"<font color='red'>*</font>物品",name:"cgname",readonly:!0,type:"auto","class":"required"},{head:"<font color='red'>*</font>领用数量",name:"cgnum",readonly:!1,type:"number","class":"required"},{head:"单位",name:"cgunit",readonly:!0,type:"text"},{head:"库存",name:"cgkc",readonly:!0,type:"text","class":"required"}],t="领用物品",n="tablelist2"),cdbjs.lx=a;var i=cdbjs.inittable(t,e,n);cdbjs.openid=$(".inittable").attr("tmp"),$(".inittable").html(i)}};